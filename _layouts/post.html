---
layout: base
# Requires: page.title, page.tags
---
{%- assign time_estimated = content | number_of_words | divided_by: 300 | plus: 1 | append: " minutes" -%}
{%- if page contains "time" -%}
{%- assign time_estimated = page.time -%}
{%- endif -%}
<header>
  <section class="container-fluid pt-5">
    <div class="float-start col-md-8 pe-2">
      <h1>{{ page.title | escape }}</h1>
      <p>By
        {%- for author in page.authors %}
        <!-- link to posts by author -->
        {{ author }}
        {%- endfor -%}
      </p>
      <p>{{ time_estimated }}</p>
    </div>
    <aside class="margin-note mb-5">
      <p>
        {%- for tag in page.tags %}
        <a href="/posts-by-tag#{{ tag | slugify }}">#{{ tag }}</a>
        {% endfor -%}
      </p>
      <p>
        {{ page.date | date: "%Y-%m-%d" }}
        {%- for update in page.updates -%}
        <br>{{ update.date | date: "%Y-%m-%d" }}: {{ update.changes | escape }}
        {%- endfor -%}
      </p>
      <p class="mb-0">
        <a target="_blank"
          href="https://github.com/fulldecent/blog.phor.net/commits/main/{{- page.path | escape  -}}">Edit history</a>
        <br><a target="_blank"
          href="https://github.com/fulldecent/blog.phor.net/edit/main/{{- page.path | escape  -}}">Edit this page</a>
      </p>
    </aside>
    <div class="clearfix"></div>
  </section>
</header>
<article class="container-fluid">
  <div class="clearfix"></div><!-- This helps if the first item in the article is a margin note -->
  {% if page.affiliate-link %}
  <p>
    <em>This page includes an affiliate link. And hopefully I'll get paid if you click it. This does not increase the
      price you pay, you would get the same price with or without my link.</em>
  </p>
  {% endif %}

  {{ content }}
  <p>&#9639;</p>
  <h2>Comments</h2>

  {%- if page.comments -%}
  {%- for comment in page.comments %}
  <blockquote>
    <p>{{ comment.text | newline_to_br }}</p>
    <cite class="d-block blockquote-footer"><a href="{{ comment.link | escape }}">{{ comment.name | escape }}</a></cite>
  </blockquote>
  {%- endfor -%}
  {%- else -%}
  <p>There are no comments yet.</p>
  {%- endif -%}

  <p>Please discuss this topic anywhere and <a href="https://phor.net/#authentic-accounts">let me know</a> any great
    comments or media coverage I should link here.</p>
</article>
<aside class="container-fluid">
  <h2>
    Related articles
  </h2>
  {% assign posts = site.posts | sort: 'date' %}
  {% for post in posts %}
  {% if post.id == page.id %}
  {% assign currIndex = forloop.index0 %}
  {% assign prevIndex = currIndex | minus: 1 %}
  {% assign nextIndex = currIndex | plus: 1 %}
  {% assign articleIndexLength = forloop.length | minus: 1 %}
  <div class="row">
    <div class="col">
      <p class="mb-0">
        <i class="bi bi-clock"></i>
        In time order:
      </p>
      <ul>
        <li>
          {% if currIndex == 0 %}
          (This is the first post, no earlier posts)
          {% else %}
          &laquo; Older <a href="{{ site.url }}{{ site.baseurl }}{{ posts[prevIndex].url }}">
            {{ posts[prevIndex].title | escape
            }}</a>
          {% endif %}
        </li>
        <li>
          {% if currIndex == articleIndexLength %}
          This is the latest post, subscribe below and be the first to see the next one.
          {% else %}
          &raquo; Newer
          <a href="{{ site.url }}{{ site.baseurl }}{{ posts[nextIndex].url }}">{{ posts[nextIndex].title | escape
            }} </a>
          {% endif %}
        </li>
      </ul>
    </div>

    {% comment %} Track shown post IDs to avoid duplicates {% endcomment %}
    {% assign shown_ids = page.id %}
    {% if currIndex != 0 %}
    {% assign shown_ids = shown_ids | append: "," | append: posts[prevIndex].id %}
    {% endif %}
    {% if currIndex != articleIndexLength %}
    {% assign shown_ids = shown_ids | append: "," | append: posts[nextIndex].id %}
    {% endif %}

    {% comment %} Show up to 3 tags {% endcomment %}
    {% for tag in page.tags %}
    {% if forloop.index0 < 3 %} {% assign tag_posts="" %} {% assign tag_post_count=0 %} {% comment %} Collect posts with
      this tag, excluding shown ones {% endcomment %} {% for p in site.posts %} {% if p.tags contains tag and
      tag_post_count < 3 %} {% unless shown_ids contains p.id %} {% if tag_posts=="" %} {% assign tag_posts=p.id %} {%
      else %} {% assign tag_posts=tag_posts | append: "," | append: p.id %} {% endif %} {% assign
      tag_post_count=tag_post_count | plus: 1 %} {% assign shown_ids=shown_ids | append: "," | append: p.id %} {%
      endunless %} {% endif %} {% endfor %} {% if tag_post_count> 0 %}
      <div class="col">
        <p class="mb-0">
          <i class="bi bi-tag"></i>
          More on <a href="/posts-by-tag#{{ tag | slugify }}">#{{ tag }}</a>:
        </p>
        <ul>
          {% assign tag_post_ids = tag_posts | split: "," %}
          {% for tag_post_id in tag_post_ids %}
          {% for p in site.posts %}
          {% if p.id == tag_post_id %}
          <li><a href="{{ site.url }}{{ site.baseurl }}{{ p.url }}">{{ p.title | escape }}</a></li>
          {% endif %}
          {% endfor %}
          {% endfor %}
        </ul>
      </div>
      {% endif %}
      {% endif %}
      {% endfor %}
  </div>
  {% endif %}
  {% endfor %}
</aside>